# Ошибки и решения

Документация проблем, с которыми столкнулись при разработке, и их решения.

## Проблемы с файловой системой

### 1. Заблокированная папка `public`

**Проблема:**
```
EPERM: operation not permitted, lstat 'E:\my-notes\public\prescript.js'
```

**Причина:**
- Процессы Node.js держали файлы открытыми
- Браузер блокировал файлы при работе с `localhost`

**Решение:**
1. Остановить все процессы Node.js:
   ```bash
   tasklist | findstr node
   taskkill //F //IM node.exe
   ```
2. Закрыть все окна браузера с `localhost`
3. Пересобрать проект:
   ```bash
   npx quartz build
   ```

**Профилактика:**
- Всегда останавливать dev-сервер перед пересборкой
- Использовать `Ctrl+C` для корректной остановки сервера
- Закрывать браузер при проблемах с файлами

---

### 2. Файл `nul` в корне проекта

**Проблема:**
Ошибочно создан файл `nul` в корне проекта.

**Причина:**
- Возможно, ошибка при перенаправлении вывода в Windows

**Решение:**
```bash
rm nul
```

**Профилактика:**
- В Windows избегать использования `nul` как имени файла
- Использовать `NUL` для перенаправления в никуда (Windows эквивалент `/dev/null`)

---

## Проблемы с портами

### 3. Занятые порты при запуске сервера

**Проблема:**
```
Error: Port 8080 is already in use
Error: Port 3000 is already in use
Error: Port 4000 is already in use
```

**Причина:**
- Несколько экземпляров dev-сервера работают одновременно
- Другие приложения используют эти порты

**Решение:**
1. Найти процессы на портах:
   ```bash
   netstat -ano | findstr ":8080"
   ```
2. Убить процесс по PID или использовать другой порт:
   ```bash
   npx quartz build --serve --port 5000
   ```

**Профилактика:**
- Останавливать предыдущий сервер перед запуском нового
- Использовать фоновый режим только когда необходимо

---

## Проблемы с архитектурой Quartz

### 4. HomePage не использовался на главной странице

**Проблема:**
Создан компонент `HomePage.tsx`, но он не применялся к главной странице.

**Причина:**
- Компонент был создан и экспортирован, но не интегрирован в `contentPage.tsx`
- `pageBody` устанавливался один раз для всех страниц

**Решение:**
Модифицировать `quartz/plugins/emitters/contentPage.tsx`:
```typescript
async function processContent(...) {
  const slug = fileData.slug!

  // Use HomePage component for the index page, Content for others
  const pageBody = slug === "index" ? HomePage() : opts.pageBody
  const pageOpts = { ...opts, pageBody }

  const content = renderPage(cfg, slug, componentData, pageOpts, externalResources)
  // ...
}
```

**Профилактика:**
- При создании нового компонента страницы сразу проверять, где и как он будет применяться
- Изучать архитектуру emitters и понимать flow рендеринга

---

### 5. RecentNotes показывал простой список вместо карточек

**Проблема:**
Компонент отображал статьи в виде простого списка `<ul><li>`, а не карточек.

**Причина:**
- Стандартная структура компонента использует списки
- Не было стилей для карточного дизайна

**Решение:**
1. Изменить структуру HTML в `RecentNotes.tsx` на карточки:
   ```tsx
   <div class="blog-cards-grid">
     <a href="..." class="blog-card">
       <div class="blog-card-image">...</div>
       <div class="blog-card-content">
         <h3 class="blog-card-title">...</h3>
         <p class="blog-card-description">...</p>
       </div>
     </a>
   </div>
   ```
2. Добавить стили в `custom.scss`

**Профилактика:**
- Планировать дизайн до модификации компонентов
- Использовать CSS Grid/Flexbox для современных макетов

---

## Лучшие практики

### Работа с Quartz
1. **Всегда читать файл перед редактированием** - понять текущую структуру
2. **Изучать emitters** - понимать, как страницы генерируются
3. **Тестировать на локальном сервере** - проверять изменения до коммита
4. **Останавливать сервер перед пересборкой** - избегать блокировок файлов

### Git workflow
1. **Проверять статус перед коммитом** - `git status`
2. **Использовать осмысленные сообщения коммитов** - описывать что и зачем сделано
3. **Добавлять Co-Authored-By** - указывать участие AI ассистента

### Отладка
1. **Читать вывод build** - обращать внимание на warnings
2. **Проверять логи сервера** - использовать `tail` для фоновых процессов
3. **Использовать git diff** - проверять изменения перед коммитом

---

## Checklist перед деплоем

- [ ] Все процессы Node.js остановлены
- [ ] Проект успешно собирается (`npx quartz build`)
- [ ] Сервер запускается без ошибок
- [ ] Все страницы открываются в браузере
- [ ] Проверены mobile и desktop версии
- [ ] Git статус чист
- [ ] Коммит создан с описательным сообщением
- [ ] Изменения запушены в remote

---

*Последнее обновление: 2026-02-08*
