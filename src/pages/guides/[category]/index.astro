---
import Layout from '../../../layouts/Layout.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const categories = ['seo', 'funnels', 'monetization', 'ai-tools'];
  return categories.map((category) => ({ params: { category } }));
}

const { category } = Astro.params;

const allGuides = await getCollection('guides');
const guides = allGuides
  .filter((g) => g.data.category === category)
  .sort((a, b) => a.data.order - b.data.order);

// Группируем по модулям
const modules = guides.reduce((acc, guide) => {
  const key = guide.data.module;
  if (!acc[key]) {
    acc[key] = { moduleTitle: guide.data.moduleTitle, lessons: [] };
  }
  acc[key].lessons.push(guide);
  return acc;
}, {} as Record<number, { moduleTitle: string; lessons: typeof guides }>);

const categoryTitles: Record<string, string> = {
  seo: 'SEO-продвижение',
  funnels: 'Воронки продаж',
  monetization: 'Монетизация',
  'ai-tools': 'ИИ-инструменты',
};

const categoryTitle = categoryTitles[category] ?? category;
---

<Layout
  title={`${categoryTitle} | ВоронщикPro`}
  description={`Все уроки раздела "${categoryTitle}". Практические гайды от Артёма Воронова.`}
>
  <div class="max-w-3xl mx-auto px-4 py-12">

    <!-- Назад -->
    <a href="/" class="inline-flex items-center gap-2 text-sm text-gray-500 hover:text-white transition-colors mb-8 border border-border rounded-md px-3 py-1.5">
      ← Все разделы
    </a>

    <!-- Заголовок -->
    <h1 class="text-3xl font-bold text-white mb-10">{categoryTitle}</h1>

    <!-- Модули -->
    <div class="space-y-8">
      {Object.entries(modules)
        .sort(([a], [b]) => Number(a) - Number(b))
        .map(([moduleNum, { moduleTitle, lessons }]) => (
          <div>
            <!-- Лейбл модуля -->
            <p class="text-xs text-gray-500 mb-3 tracking-wide">
              Модуль {moduleNum}: {moduleTitle}
            </p>

            <!-- Карточки уроков -->
            <div class="space-y-2">
              {lessons.map((lesson) => (
                <a
                  href={`/guides/${lesson.data.category}/${lesson.slug.split('/').pop()}/`}
                  class="flex items-center gap-4 p-4 bg-card rounded-lg border border-border hover:border-accent hover:bg-card-hover transition-all group"
                >
                  <span class="text-lg flex-shrink-0">{lesson.data.icon}</span>
                  <span class="text-white group-hover:text-accent transition-colors font-medium">
                    {lesson.data.title}
                  </span>
                  <svg class="w-4 h-4 text-gray-600 ml-auto flex-shrink-0 group-hover:text-accent transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                  </svg>
                </a>
              ))}
            </div>
          </div>
        ))
      }
    </div>

  </div>
</Layout>
